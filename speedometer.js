'use strict';

var gauge = function gauge(container, configuration, cfg) {
    var that = {};
    var config = cfg || {
        size: 200,
        clipWidth: 200,
        clipHeight: 110,
        ringInset: 20,
        ringWidth: 20,

        pointerWidth: 10,
        pointerTailLength: 5,
        pointerHeadLengthPercent: 0.9,

        minValue: 0,
        maxValue: 10,

        minAngle: -90,
        maxAngle: 90,

        transitionMs: 750,

        majorTicks: 5,
        labelFormat: d3.format(',g'),
        labelInset: 10,

        arcColorFn: d3.interpolateHsl(d3.rgb('#e8e2ca'), d3.rgb('#3e6c0a'))
    };
    var range = undefined;
    var r = undefined;
    var pointerHeadLength = undefined;
    var value = 0;

    var svg = undefined;
    var arc = undefined;
    var scale = undefined;
    var ticks = undefined;
    var tickData = undefined;
    var pointer = undefined;

    var donut = d3.layout.pie();

    function deg2rad(deg) {
        return deg * Math.PI / 180;
    }

    function newAngle(d) {
        var ratio = scale(d);
        var newAngle = config.minAngle + ratio * range;
        return newAngle;
    }

    function configure(configuration) {
        var prop = undefined;
        for (prop in configuration) {
            config[prop] = configuration[prop];
        }

        range = config.maxAngle - config.minAngle;
        r = config.size / 2;
        pointerHeadLength = Math.round(r * config.pointerHeadLengthPercent);

        // a linear scale that maps domain values to a percent from 0..1
        scale = d3.scale.linear().range([0, 1]).domain([config.minValue, config.maxValue]);

        ticks = scale.ticks(config.majorTicks);
        tickData = d3.range(config.majorTicks).map(function () {
            return 1 / config.majorTicks;
        });

        arc = d3.svg.arc().innerRadius(r - config.ringWidth - config.ringInset).outerRadius(r - config.ringInset).startAngle(function (d, i) {
            var ratio = d * i;
            return deg2rad(config.minAngle + ratio * range);
        }).endAngle(function (d, i) {
            var ratio = d * (i + 1);
            return deg2rad(config.minAngle + ratio * range);
        });
    }
    that.configure = configure;

    function centerTranslation() {
        return 'translate(' + r + ',' + r + ')';
    }

    function isRendered() {
        return svg !== undefined;
    }
    that.isRendered = isRendered;

    function render(newValue) {
        svg = d3.select(container).append('svg:svg').attr('class', 'gauge').attr('width', config.clipWidth).attr('height', config.clipHeight);

        var centerTx = centerTranslation();

        var arcs = svg.append('g').attr('class', 'arc').attr('transform', centerTx);

        arcs.selectAll('path').data(tickData).enter().append('path').attr('fill', function (d, i) {
            return config.arcColorFn(d * i);
        }).attr('d', arc);

        var lg = svg.append('g').attr('class', 'label').attr('transform', centerTx);
        lg.selectAll('text').data(ticks).enter().append('text').attr('transform', function (d) {
            var ratio = scale(d);
            var newAngle = config.minAngle + ratio * range;
            return 'rotate(' + newAngle + ') translate(0,' + (config.labelInset - r) + ')';
        }).text(config.labelFormat);

        var lineData = [[config.pointerWidth / 2, 0], [0, -pointerHeadLength], [-(config.pointerWidth / 2), 0], [0, config.pointerTailLength], [config.pointerWidth / 2, 0]];
        var pointerLine = d3.svg.line().interpolate('monotone');
        var pg = svg.append('g').data([lineData]).attr('class', 'pointer').attr('transform', centerTx);

        pointer = pg.append('path').attr('d', pointerLine /*function(d) { return pointerLine(d) +'Z';}*/).attr('transform', 'rotate(' + config.minAngle + ')');

        update(newValue === undefined ? 0 : newValue);
    }
    that.render = render;

    function update(newValue, newConfiguration) {
        if (newConfiguration !== undefined) {
            configure(newConfiguration);
        }
        var ratio = scale(newValue);
        var newAngle = config.minAngle + ratio * range;
        pointer.transition().duration(config.transitionMs).ease('elastic').attr('transform', 'rotate(' + newAngle + ')');
    }
    that.update = update;

    configure(configuration);

    return that;
};
//# sourceMappingURL=data:application/json;base64,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QUFNLENBQUMsTUFBTSxDQUFDLENBQ3RCLElBQUksQ0FBQyxHQUFHLEVBQUUsV0FBVyxnREFBZ0QsQ0FDckUsSUFBSSxDQUFDLFdBQVcsRUFBRSxTQUFTLEdBQUUsTUFBTSxDQUFDLFFBQVEsR0FBRSxHQUFHLENBQUMsQ0FBQzs7QUFFeEQsY0FBTSxDQUFDLFFBQVEsS0FBSyxTQUFTLEdBQUcsQ0FBQyxHQUFHLFFBQVEsQ0FBQyxDQUFDO0tBQ2pEO0FBQ0QsUUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7O0FBRXJCLGFBQVMsTUFBTSxDQUFDLFFBQVEsRUFBRSxnQkFBZ0IsRUFBRTtBQUN4QyxZQUFLLGdCQUFnQixLQUFNLFNBQVMsRUFBRTtBQUNsQyxxQkFBUyxDQUFDLGdCQUFnQixDQUFDLENBQUM7U0FDL0I7QUFDRCxZQUFJLEtBQUssR0FBRyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDNUIsWUFBSSxRQUFRLEdBQUcsTUFBTSxDQUFDLFFBQVEsR0FBSSxLQUFLLEdBQUcsS0FBSyxBQUFDLENBQUM7QUFDakQsZUFBTyxDQUFDLFVBQVUsRUFBRSxDQUNmLFFBQVEsQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLENBQzdCLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FDZixJQUFJLENBQUMsV0FBVyxFQUFFLFNBQVMsR0FBRSxRQUFRLEdBQUUsR0FBRyxDQUFDLENBQUM7S0FDcEQ7QUFDRCxRQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQzs7QUFFckIsYUFBUyxDQUFDLGFBQWEsQ0FBQyxDQUFDOztBQUV6QixXQUFPLElBQUksQ0FBQztDQUNmLENBQUMiLCJmaWxlIjoic3JjL3NwZWVkb21ldGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGdhdWdlID0gZnVuY3Rpb24oY29udGFpbmVyLCBjb25maWd1cmF0aW9uLCBjZmcpIHtcbiAgICB2YXIgdGhhdCA9IHt9O1xuICAgIHZhciBjb25maWcgPSBjZmcgfHwge1xuICAgICAgICBzaXplXHRcdFx0XHRcdFx0OiAyMDAsXG4gICAgICAgIGNsaXBXaWR0aFx0XHRcdFx0XHQ6IDIwMCxcbiAgICAgICAgY2xpcEhlaWdodFx0XHRcdFx0XHQ6IDExMCxcbiAgICAgICAgcmluZ0luc2V0XHRcdFx0XHRcdDogMjAsXG4gICAgICAgIHJpbmdXaWR0aFx0XHRcdFx0XHQ6IDIwLFxuXG4gICAgICAgIHBvaW50ZXJXaWR0aFx0XHRcdFx0OiAxMCxcbiAgICAgICAgcG9pbnRlclRhaWxMZW5ndGhcdFx0XHQ6IDUsXG4gICAgICAgIHBvaW50ZXJIZWFkTGVuZ3RoUGVyY2VudFx0OiAwLjksXG5cbiAgICAgICAgbWluVmFsdWVcdFx0XHRcdFx0OiAwLFxuICAgICAgICBtYXhWYWx1ZVx0XHRcdFx0XHQ6IDEwLFxuXG4gICAgICAgIG1pbkFuZ2xlXHRcdFx0XHRcdDogLTkwLFxuICAgICAgICBtYXhBbmdsZVx0XHRcdFx0XHQ6IDkwLFxuXG4gICAgICAgIHRyYW5zaXRpb25Nc1x0XHRcdFx0OiA3NTAsXG5cbiAgICAgICAgbWFqb3JUaWNrc1x0XHRcdFx0XHQ6IDUsXG4gICAgICAgIGxhYmVsRm9ybWF0XHRcdFx0XHRcdDogZDMuZm9ybWF0KCcsZycpLFxuICAgICAgICBsYWJlbEluc2V0XHRcdFx0XHRcdDogMTAsXG5cbiAgICAgICAgYXJjQ29sb3JGblx0XHRcdFx0XHQ6IGQzLmludGVycG9sYXRlSHNsKGQzLnJnYignI2U4ZTJjYScpLCBkMy5yZ2IoJyMzZTZjMGEnKSlcbiAgICB9O1xuICAgIHZhciByYW5nZSA9IHVuZGVmaW5lZDtcbiAgICB2YXIgciA9IHVuZGVmaW5lZDtcbiAgICB2YXIgcG9pbnRlckhlYWRMZW5ndGggPSB1bmRlZmluZWQ7XG4gICAgdmFyIHZhbHVlID0gMDtcblxuICAgIHZhciBzdmcgPSB1bmRlZmluZWQ7XG4gICAgdmFyIGFyYyA9IHVuZGVmaW5lZDtcbiAgICB2YXIgc2NhbGUgPSB1bmRlZmluZWQ7XG4gICAgdmFyIHRpY2tzID0gdW5kZWZpbmVkO1xuICAgIHZhciB0aWNrRGF0YSA9IHVuZGVmaW5lZDtcbiAgICB2YXIgcG9pbnRlciA9IHVuZGVmaW5lZDtcblxuICAgIHZhciBkb251dCA9IGQzLmxheW91dC5waWUoKTtcblxuICAgIGZ1bmN0aW9uIGRlZzJyYWQoZGVnKSB7XG4gICAgICAgIHJldHVybiBkZWcgKiBNYXRoLlBJIC8gMTgwO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIG5ld0FuZ2xlKGQpIHtcbiAgICAgICAgdmFyIHJhdGlvID0gc2NhbGUoZCk7XG4gICAgICAgIHZhciBuZXdBbmdsZSA9IGNvbmZpZy5taW5BbmdsZSArIChyYXRpbyAqIHJhbmdlKTtcbiAgICAgICAgcmV0dXJuIG5ld0FuZ2xlO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNvbmZpZ3VyZShjb25maWd1cmF0aW9uKSB7XG4gICAgICAgIHZhciBwcm9wID0gdW5kZWZpbmVkO1xuICAgICAgICBmb3IgKCBwcm9wIGluIGNvbmZpZ3VyYXRpb24gKSB7XG4gICAgICAgICAgICBjb25maWdbcHJvcF0gPSBjb25maWd1cmF0aW9uW3Byb3BdO1xuICAgICAgICB9XG5cbiAgICAgICAgcmFuZ2UgPSBjb25maWcubWF4QW5nbGUgLSBjb25maWcubWluQW5nbGU7XG4gICAgICAgIHIgPSBjb25maWcuc2l6ZSAvIDI7XG4gICAgICAgIHBvaW50ZXJIZWFkTGVuZ3RoID0gTWF0aC5yb3VuZChyICogY29uZmlnLnBvaW50ZXJIZWFkTGVuZ3RoUGVyY2VudCk7XG5cbiAgICAgICAgLy8gYSBsaW5lYXIgc2NhbGUgdGhhdCBtYXBzIGRvbWFpbiB2YWx1ZXMgdG8gYSBwZXJjZW50IGZyb20gMC4uMVxuICAgICAgICBzY2FsZSA9IGQzLnNjYWxlLmxpbmVhcigpXG4gICAgICAgICAgICAucmFuZ2UoWzAsMV0pXG4gICAgICAgICAgICAuZG9tYWluKFtjb25maWcubWluVmFsdWUsIGNvbmZpZy5tYXhWYWx1ZV0pO1xuXG4gICAgICAgIHRpY2tzID0gc2NhbGUudGlja3MoY29uZmlnLm1ham9yVGlja3MpO1xuICAgICAgICB0aWNrRGF0YSA9IGQzLnJhbmdlKGNvbmZpZy5tYWpvclRpY2tzKS5tYXAoZnVuY3Rpb24oKSB7cmV0dXJuIDEvY29uZmlnLm1ham9yVGlja3M7fSk7XG5cbiAgICAgICAgYXJjID0gZDMuc3ZnLmFyYygpXG4gICAgICAgICAgICAuaW5uZXJSYWRpdXMociAtIGNvbmZpZy5yaW5nV2lkdGggLSBjb25maWcucmluZ0luc2V0KVxuICAgICAgICAgICAgLm91dGVyUmFkaXVzKHIgLSBjb25maWcucmluZ0luc2V0KVxuICAgICAgICAgICAgLnN0YXJ0QW5nbGUoZnVuY3Rpb24oZCwgaSkge1xuICAgICAgICAgICAgICAgIHZhciByYXRpbyA9IGQgKiBpO1xuICAgICAgICAgICAgICAgIHJldHVybiBkZWcycmFkKGNvbmZpZy5taW5BbmdsZSArIChyYXRpbyAqIHJhbmdlKSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmVuZEFuZ2xlKGZ1bmN0aW9uKGQsIGkpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmF0aW8gPSBkICogKGkrMSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZzJyYWQoY29uZmlnLm1pbkFuZ2xlICsgKHJhdGlvICogcmFuZ2UpKTtcbiAgICAgICAgICAgIH0pO1xuICAgIH1cbiAgICB0aGF0LmNvbmZpZ3VyZSA9IGNvbmZpZ3VyZTtcblxuICAgIGZ1bmN0aW9uIGNlbnRlclRyYW5zbGF0aW9uKCkge1xuICAgICAgICByZXR1cm4gJ3RyYW5zbGF0ZSgnK3IgKycsJysgciArJyknO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGlzUmVuZGVyZWQoKSB7XG4gICAgICAgIHJldHVybiAoc3ZnICE9PSB1bmRlZmluZWQpO1xuICAgIH1cbiAgICB0aGF0LmlzUmVuZGVyZWQgPSBpc1JlbmRlcmVkO1xuXG4gICAgZnVuY3Rpb24gcmVuZGVyKG5ld1ZhbHVlKSB7XG4gICAgICAgIHN2ZyA9IGQzLnNlbGVjdChjb250YWluZXIpXG4gICAgICAgICAgICAuYXBwZW5kKCdzdmc6c3ZnJylcbiAgICAgICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnZ2F1Z2UnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd3aWR0aCcsIGNvbmZpZy5jbGlwV2lkdGgpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2hlaWdodCcsIGNvbmZpZy5jbGlwSGVpZ2h0KTtcblxuICAgICAgICB2YXIgY2VudGVyVHggPSBjZW50ZXJUcmFuc2xhdGlvbigpO1xuXG4gICAgICAgIHZhciBhcmNzID0gc3ZnLmFwcGVuZCgnZycpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2FyYycpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3RyYW5zZm9ybScsIGNlbnRlclR4KTtcblxuICAgICAgICBhcmNzLnNlbGVjdEFsbCgncGF0aCcpXG4gICAgICAgICAgICAgICAgLmRhdGEodGlja0RhdGEpXG4gICAgICAgICAgICAuZW50ZXIoKS5hcHBlbmQoJ3BhdGgnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdmaWxsJywgZnVuY3Rpb24oZCwgaSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29uZmlnLmFyY0NvbG9yRm4oZCAqIGkpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2QnLCBhcmMpO1xuXG4gICAgICAgIHZhciBsZyA9IHN2Zy5hcHBlbmQoJ2cnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdsYWJlbCcpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3RyYW5zZm9ybScsIGNlbnRlclR4KTtcbiAgICAgICAgbGcuc2VsZWN0QWxsKCd0ZXh0JylcbiAgICAgICAgICAgICAgICAuZGF0YSh0aWNrcylcbiAgICAgICAgICAgIC5lbnRlcigpLmFwcGVuZCgndGV4dCcpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3RyYW5zZm9ybScsIGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJhdGlvID0gc2NhbGUoZCk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBuZXdBbmdsZSA9IGNvbmZpZy5taW5BbmdsZSArIChyYXRpbyAqIHJhbmdlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdyb3RhdGUoJyArbmV3QW5nbGUgKycpIHRyYW5zbGF0ZSgwLCcgKyhjb25maWcubGFiZWxJbnNldCAtIHIpICsnKSc7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAudGV4dChjb25maWcubGFiZWxGb3JtYXQpO1xuXG4gICAgICAgIHZhciBsaW5lRGF0YSA9IFsgW2NvbmZpZy5wb2ludGVyV2lkdGggLyAyLCAwXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFswLCAtcG9pbnRlckhlYWRMZW5ndGhdLFxuICAgICAgICAgICAgICAgICAgICAgICAgWy0oY29uZmlnLnBvaW50ZXJXaWR0aCAvIDIpLCAwXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFswLCBjb25maWcucG9pbnRlclRhaWxMZW5ndGhdLFxuICAgICAgICAgICAgICAgICAgICAgICAgW2NvbmZpZy5wb2ludGVyV2lkdGggLyAyLCAwXSBdO1xuICAgICAgICB2YXIgcG9pbnRlckxpbmUgPSBkMy5zdmcubGluZSgpLmludGVycG9sYXRlKCdtb25vdG9uZScpO1xuICAgICAgICB2YXIgcGcgPSBzdmcuYXBwZW5kKCdnJykuZGF0YShbbGluZURhdGFdKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdwb2ludGVyJylcbiAgICAgICAgICAgICAgICAuYXR0cigndHJhbnNmb3JtJywgY2VudGVyVHgpO1xuXG4gICAgICAgIHBvaW50ZXIgPSBwZy5hcHBlbmQoJ3BhdGgnKVxuICAgICAgICAgICAgLmF0dHIoJ2QnLCBwb2ludGVyTGluZS8qZnVuY3Rpb24oZCkgeyByZXR1cm4gcG9pbnRlckxpbmUoZCkgKydaJzt9Ki8gKVxuICAgICAgICAgICAgLmF0dHIoJ3RyYW5zZm9ybScsICdyb3RhdGUoJyArY29uZmlnLm1pbkFuZ2xlICsnKScpO1xuXG4gICAgICAgIHVwZGF0ZShuZXdWYWx1ZSA9PT0gdW5kZWZpbmVkID8gMCA6IG5ld1ZhbHVlKTtcbiAgICB9XG4gICAgdGhhdC5yZW5kZXIgPSByZW5kZXI7XG5cbiAgICBmdW5jdGlvbiB1cGRhdGUobmV3VmFsdWUsIG5ld0NvbmZpZ3VyYXRpb24pIHtcbiAgICAgICAgaWYgKCBuZXdDb25maWd1cmF0aW9uICAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBjb25maWd1cmUobmV3Q29uZmlndXJhdGlvbik7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHJhdGlvID0gc2NhbGUobmV3VmFsdWUpO1xuICAgICAgICB2YXIgbmV3QW5nbGUgPSBjb25maWcubWluQW5nbGUgKyAocmF0aW8gKiByYW5nZSk7XG4gICAgICAgIHBvaW50ZXIudHJhbnNpdGlvbigpXG4gICAgICAgICAgICAuZHVyYXRpb24oY29uZmlnLnRyYW5zaXRpb25NcylcbiAgICAgICAgICAgIC5lYXNlKCdlbGFzdGljJylcbiAgICAgICAgICAgIC5hdHRyKCd0cmFuc2Zvcm0nLCAncm90YXRlKCcgK25ld0FuZ2xlICsnKScpO1xuICAgIH1cbiAgICB0aGF0LnVwZGF0ZSA9IHVwZGF0ZTtcblxuICAgIGNvbmZpZ3VyZShjb25maWd1cmF0aW9uKTtcblxuICAgIHJldHVybiB0aGF0O1xufTtcbiJdfQ==